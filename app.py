
import os
import io
import csv
import time
from datetime import datetime
from typing import Dict, Any, List

import pandas as pd
import streamlit as st

from reportlab.lib.pagesizes import A4
from reportlab.lib.units import mm
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.lib import colors
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont

PASS_SCORE = 8
CRITICAL_Q_IDS = {1, 2, 4}
DATA_DIR = "data"
RESULTS_CSV = os.path.join(DATA_DIR, "attestation_results.csv")
DASHBOARD_PASSWORD = "123"

QUESTIONS: List[Dict[str, Any]] = [
    {
        "id": 1,
        "q": "–ö–µ–π—Å: –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω (–¥–æ 15 –∫–í—Ç, 0.4 –∫–í) –ø–æ–¥–∞–ª –∑–∞—è–≤–∫—É –Ω–∞ –¢–ü. –ï–º—É –æ—Ç–≤–µ—Ç–∏–ª–∏: ¬´–ù–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî –æ—Ç–∫–∞–∑¬ª. –ö–∞–∫–æ–π –æ—Ç–≤–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ö–¶ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω?",
        "options": [
            "–û—Ç–∫–∞–∑ –∑–∞–∫–æ–Ω–µ–Ω: –±–µ–∑ —Ç–µ—Ö–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¢–ü –Ω–µ –¥–µ–ª–∞–µ—Ç—Å—è",
            "–û—Ç–∫–∞–∑ –∑–∞–∫–æ–Ω–µ–Ω, –µ—Å–ª–∏ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –Ω–∞ –ü–°/–¢–ü",
            "–û—Ç–∫–∞–∑ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Ö–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∞–º–æ –ø–æ —Å–µ–±–µ –Ω–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–∫–∞–∑–∞; –≤–æ–ø—Ä–æ—Å —Ä–µ—à–∞–µ—Ç—Å—è –ø–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ 861",
            "–≠—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è 861, —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞–º–∏",
        ],
        "a": 2,
        "why_wrong": {
            0: "861 –Ω–µ –¥–∞—ë—Ç ¬´—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞¬ª –ø–æ –º–æ—Ç–∏–≤—É —Ç–µ—Ö–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±—ã—Ç–æ–≤—ã—Ö –∑–∞—è–≤–∏—Ç–µ–ª–µ–π –¥–æ 15 –∫–í—Ç.",
            1: "–ù–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ—â–Ω–æ—Å—Ç–∏ ‚Äî –∫—Ä–∏—Ç–µ—Ä–∏–π, –Ω–æ —ç—Ç–æ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞–∑ ¬´–≤ –æ–¥–Ω–æ –ø–∏—Å—å–º–æ¬ª –±–µ–∑ –Ω–∞–¥–ª–µ–∂–∞—â–µ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.",
            3: "–¢–ü —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è 861; ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–≥–ª–∞–º–µ–Ω—Ç¬ª –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.",
        },
        "why_right": "–û–ø–µ—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –æ–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ ¬´–Ω–µ—Ç —Ç–µ—Ö–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏¬ª –Ω–µ —Ä–∞–≤–Ω–æ ¬´–º–æ–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å¬ª, –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É/—Ä–∞–∑–±–æ—Ä.",
        "practice": "–í–° –†–§: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Ññ 307-–≠–°23-26680 –ø–æ –¥–µ–ª—É ‚Ññ –ê21-14184/2022 (–°–ù–¢/15 –∫–í—Ç, –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π).",
        "risk": "–û—à–∏–±–∫–∞ = –∂–∞–ª–æ–±–∞ –≤ –§–ê–°/–ø—Ä–µ—Ç–µ–Ω–∑–∏—è ¬´–Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑¬ª",
    },
    {
        "id": 2,
        "q": "–ö–µ–π—Å: –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç ¬´–Ω–∞–∑–æ–≤–∏—Ç–µ —Ç–æ—á–Ω—É—é –¥–∞—Ç—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–π—Ç–µ¬ª. –ö–∞–∫ –æ—Ç–≤–µ—á–∞—Ç—å –±–µ–∑ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤?",
        "options": [
            "–ù–∞–∑–≤–∞—Ç—å —Ç–æ—á–Ω—É—é –¥–∞—Ç—É ‚Äî —Å—Ä–æ–∫–∏ –∂–µ –≤ 861 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã",
            "–ù–∞–∑–≤–∞—Ç—å ¬´–ø—Ä–∏–º–µ—Ä–Ω–æ¬ª, —á—Ç–æ–±—ã —É—Å–ø–æ–∫–æ–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞",
            "–°–∫–∞–∑–∞—Ç—å: ¬´–º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, –µ—Å–ª–∏ –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ –∂–∞–ª–æ–≤–∞—Ç—å—Å—è¬ª",
            "–ù–µ –¥–∞–≤–∞—Ç—å —Ç–æ—á–Ω—ã—Ö –æ–±–µ—â–∞–Ω–∏–π: –≥–æ–≤–æ—Ä–∏—Ç—å –≤ —Ä–∞–º–∫–∞—Ö –¥–æ–≥–æ–≤–æ—Ä–∞/—ç—Ç–∞–ø–æ–≤ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π",
        ],
        "a": 3,
        "why_wrong": {
            0: "–ö–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ –¥–∞—Ç—ã ‚Äî —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∂–∞–ª–æ–± –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –æ —Å–∞–Ω–∫—Ü–∏—è—Ö.",
            1: "–î–∞–∂–µ ¬´–ø—Ä–∏–º–µ—Ä–Ω–æ¬ª –∫–ª–∏–µ–Ω—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ –æ–±–µ—â–∞–Ω–∏–µ ‚Äî –ø–æ—Ç–æ–º —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç.",
            2: "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è; —Å–æ–∑–¥–∞—ë—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –∏ –ø—Ä–∞–≤–æ–≤–æ–π —Ä–∏—Å–∫.",
        },
        "why_right": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ: –æ–±—ä—è—Å–Ω–∏—Ç—å —ç—Ç–∞–ø–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¢–£ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é —Å—Ä–æ–∫–æ–≤.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: —Å–ø–æ—Ä—ã –æ —Å—Ä–æ–∫–∞—Ö/–Ω–µ—É—Å—Ç–æ–π–∫–∞—Ö –ø–æ –¢–ü —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–º–∏ —Å—É–¥–∞–º–∏ –æ–∫—Ä—É–≥–æ–≤.",
        "risk": "–û—à–∏–±–∫–∞ = ¬´–≤—ã –æ–±–µ—â–∞–ª–∏¬ª ‚Üí –∂–∞–ª–æ–±–∞/–Ω–µ—É—Å—Ç–æ–π–∫–∞/—ç—Å–∫–∞–ª–∞—Ü–∏—è",
    },
    {
        "id": 3,
        "q": "–ö–µ–π—Å: –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç: ¬´–∞–∫—Ç –¢–ü –ø–æ–¥–ø–∏—Å–∞–ª–∏, –Ω–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –Ω–µ—Ç¬ª. –ß—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Å–∫–∞–∑–∞—Ç—å?",
        "options": [
            "–ï—Å–ª–∏ –∞–∫—Ç –ø–æ–¥–ø–∏—Å–∞–Ω ‚Äî –≤—Å—ë, —Å–ø–æ—Ä –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω",
            "–ï—Å–ª–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –∞–∫—Ç —Ç–æ—á–Ω–æ –Ω–µ–∑–∞–∫–æ–Ω–µ–Ω",
            "–¢–ü –≤—Å–µ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–∞—á–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è",
            "–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ø–æ—Ä–Ω–æ: –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã/—Ñ–∞–∫—Ç—ã –∏ —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ –¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤",
        ],
        "a": 3,
        "why_wrong": {
            0: "–ê–∫—Ç –Ω–µ ¬´–∑–∞–∫—Ä—ã–≤–∞–µ—Ç¬ª –ª—é–±—ã–µ —Å–ø–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
            1: "–ù–µ–ª—å–∑—è –∑–∞—Ä–∞–Ω–µ–µ –∑–∞—è–≤–ª—è—Ç—å –æ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –Ω—É–∂–µ–Ω —Ä–∞–∑–±–æ—Ä –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤.",
            2: "–ö–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç—å –æ–ø–∞—Å–Ω–∞: —Å—É–¥—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ—Ü–µ–Ω–∏–≤–∞—é—Ç ¬´—Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª –¢–ü.",
        },
        "why_right": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ñ–∞–∫—Ç—ã/–¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: –≤ —Å—É–¥–∞—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–ø–æ—Ä—ã –æ —Ñ–∞–∫—Ç–µ –ø–æ–¥–∞—á–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –∏ —Ç–æ—á–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.",
        "risk": "–û—à–∏–±–∫–∞ = –Ω–µ–≤–µ—Ä–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ + –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏",
    },
    {
        "id": 4,
        "q": "–ö–µ–π—Å: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–µ—Ç–∏ –°–ù–¢, –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –Ω–µ –ø—É—Å–∫–∞–µ—Ç –∏ —Ç—Ä–µ–±—É–µ—Ç –ø–ª–∞—Ç—É. –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å?",
        "options": [
            "–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –ø—É—Å—Ç—å –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª–µ–º",
            "–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –°–ù–¢ ‚Äî –∫–ª–∏–µ–Ω—Ç—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å",
            "–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–Ω–∞ —Å–µ—Ç–µ–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
            "–û—Ñ–æ—Ä–º–∏—Ç—å —ç—Å–∫–∞–ª–∞—Ü–∏—é –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –°–ù–¢ –Ω–µ –≤–ø—Ä–∞–≤–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–æ–≤–∞—Ç—å/–≤–∑–∏–º–∞—Ç—å –ø–ª–∞—Ç—É –∑–∞ —Å–∞–º–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö",
        ],
        "a": 3,
        "why_wrong": {
            0: "–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤—Å—ë –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞: –≤ 861 –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã –ø—Ä–æ –°–ù–¢.",
            1: "–ö–ª–∏–µ–Ω—Ç—É –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–µ–Ω –¥–æ–ø—É—Å–∫/–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, –Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä –æ–±—è–∑–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∏ —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å.",
            2: "–ö–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –≤–∏–Ω—É –°–û –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî —Ä–∏—Å–∫.",
        },
        "why_right": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–µ –æ–±–µ—â–∞—Ç—å –∏—Å—Ö–æ–¥, –Ω–æ –¥–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–º–∫—É –Ω–æ—Ä–º—ã/–ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–µ–±–Ω—É—é –æ—Ç—Ä–∞–±–æ—Ç–∫—É.",
        "practice": "–í–° –†–§: ‚Ññ 307-–≠–°23-26680 (–∏ —Å—Å—ã–ª–∫–∞ –í–° –Ω–∞ –ø–æ–∑–∏—Ü–∏—é ‚Ññ 305-–≠–°23-18030) –ø—Ä–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –°–ù–¢.",
        "risk": "–û—à–∏–±–∫–∞ = –∂–∞–ª–æ–±–∞/—Å—É–¥, –º–∞—Å—Å–æ–≤—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ –°–ù–¢",
    },
    {
        "id": 5,
        "q": "–ö–µ–π—Å: –ø–æ—Å–ª–µ –¥–æ–≥–æ–≤–æ—Ä–∞ –°–û –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç ¬´–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¢–£¬ª —Å –±–æ–ª—å—à–∏–º –æ–±—ä—ë–º–æ–º —Ä–∞–±–æ—Ç. –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—É?",
        "options": [
            "–°–û –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –¢–£ –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç",
            "–¢–£ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –Ω–∏–∫–æ–≥–¥–∞",
            "–ü—É—Å—Ç—å –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–ø–∏—à–µ—Ç, –∏–Ω–∞—á–µ –µ–º—É –æ—Ç–∫–ª—é—á–∞—Ç —Å–≤–µ—Ç",
            "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –¢–£ –≤ 861 –Ω–µ –æ–ø–∏—Å–∞–Ω; –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–æ–±—ã—á–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ–º/–¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏), —É –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å –∫–∞–Ω–∞–ª –æ–±–∂–∞–ª–æ–≤–∞–Ω–∏—è",
        ],
        "a": 3,
        "why_wrong": {
            0: "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ; –Ω–µ–ª—å–∑—è –æ–±–µ—â–∞—Ç—å ¬´–º–æ–∂–µ–º –∫–∞–∫ —Ö–æ—Ç–∏–º¬ª.",
            1: "–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã, –Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—É ‚Äî ¬´–Ω–∏–∫–æ–≥–¥–∞¬ª —Ç–æ–∂–µ –Ω–µ–≤–µ—Ä–Ω–æ.",
            2: "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ñ—Ä–∞–∑–∞; —Å–æ–∑–¥–∞—ë—Ç —Ä–∏—Å–∫ –∂–∞–ª–æ–± –∏ –ø—Ä–æ–≤–µ—Ä–æ–∫.",
        },
        "why_right": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ: –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞—â–∏—Ç—ã –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: —Å—É–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–≤—è–∑—ã–≤–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –∏ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç. 310 –ì–ö –†–§).",
        "risk": "–û—à–∏–±–∫–∞ = —Å–ø–æ—Ä –æ –Ω–∞–≤—è–∑—ã–≤–∞–Ω–∏–∏ —É—Å–ª—É–≥/—É—Å–ª–æ–≤–∏–π",
    },
    {
        "id": 6,
        "q": "–ö–µ–π—Å: –∫–ª–∏–µ–Ω—Ç: ¬´–≤ –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –≤—ã –Ω–µ –æ–±—è–∑–∞–Ω—ã –¥–µ–ª–∞—Ç—å –¢–ü¬ª. –û—Ç–≤–µ—Ç?",
        "options": [
            "–î–∞, –±–µ–∑ –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–≥—Ä–∞–º–º—ã –¢–ü –Ω–µ –¥–µ–ª–∞–µ—Ç—Å—è",
            "–î–∞, —ç—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –°–û –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞",
            "–ù–µ—Ç, –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ–º –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –¢–ü –ø–æ 861",
            "–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫—Ç–æ –∫–ª–∏–µ–Ω—Ç ‚Äî —Ñ–∏–∑–ª–∏—Ü–æ –∏–ª–∏ —é—Ä–ª–∏—Ü–æ",
        ],
        "a": 2,
        "why_wrong": {
            0: "–ò–Ω–≤–µ—Å—Ç–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º –æ—Ç–∫–∞–∑–∞ –ø–æ 861.",
            1: "–ù–µ–ª—å–∑—è –æ–±–µ—â–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–æ —Ç–∞–∫–æ–º—É –º–æ—Ç–∏–≤—É.",
            3: "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ –Ω—é–∞–Ω—Å—ã, –Ω–æ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç ¬´–Ω–µ—Ç –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–≥—Ä–∞–º–º—ã¬ª –≤ –æ—Ç–∫–∞–∑.",
        },
        "why_right": "–û–ø–µ—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –æ–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å –¢–ü —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è 861 –∏ –¥–æ–≥–æ–≤–æ—Ä–æ–º, –∞ –Ω–µ –Ω–∞–ª–∏—á–∏–µ–º –∏–Ω–≤–µ—Å—Ç–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: —Å—É–¥—ã –æ–±—ã—á–Ω–æ –∏—Å—Ö–æ–¥—è—Ç –∏–∑ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª –¢–ü –∏ –¥–æ–≥–æ–≤–æ—Ä–∞.",
        "risk": "–û—à–∏–±–∫–∞ = –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑/–∑–∞—Ç—è–≥–∏–≤–∞–Ω–∏–µ",
    },
    {
        "id": 7,
        "q": "–ö–µ–π—Å: –∏–Ω–∂–µ–Ω–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç: ¬´–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ, –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∞–≤–∞—Ä–∏–∏¬ª. –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É?",
        "options": [
            "–ú–æ–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å —Å—Ä–∞–∑—É: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ",
            "–ú–æ–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å, –µ—Å–ª–∏ —Ç–∞–∫ —Å–∫–∞–∑–∞–ª–∏ –∏–Ω–∂–µ–Ω–µ—Ä—ã",
            "–ù—É–∂–Ω–∞ –ø—Ä–∞–≤–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: ¬´–æ–ø–∞—Å–Ω–æ¬ª –Ω–µ —Ä–∞–≤–Ω–æ ¬´–æ—Ç–∫–∞–∑ –ø–æ 861¬ª",
            "–°–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É: ¬´—ç—Ç–æ –Ω–µ –Ω–∞—à–∞ –ø—Ä–æ–±–ª–µ–º–∞¬ª",
        ],
        "a": 2,
        "why_wrong": {
            0: "–û—Ç–∫–∞–∑ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–æ—Ä–º–µ/–ø—Ä–æ—Ü–µ–¥—É—Ä–µ, –∞ –Ω–µ –ª–æ–∑—É–Ω–≥–µ.",
            1: "–£—Å—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∏–Ω–∂–µ–Ω–µ—Ä–∞ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–æ–≤–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ.",
            3: "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è.",
        },
        "why_right": "–û–ø–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é –ø—Ä–∏—á–∏–Ω/–ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏ —ç—Å–∫–∞–ª–∞—Ü–∏—é.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: —Å—É–¥—ã —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.",
        "risk": "–û—à–∏–±–∫–∞ = –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–∫–∞–∑/–∂–∞–ª–æ–±–∞",
    },
    {
        "id": 8,
        "q": "–ö–µ–π—Å: –∫–ª–∏–µ–Ω—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª —Å–≤–æ–∏ –¢–£ (–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –≤–≤–æ–¥/—â–∏—Ç). –ú–æ–∂–Ω–æ –ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å ¬´—Å—Ä–æ–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–¥–≤–∏–Ω—É–ª–∏—Å—å¬ª?",
        "options": [
            "–î–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
            "–ù–µ—Ç, —Å—Ä–æ–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è",
            "–î–∞, –ø–æ —Ä–µ—à–µ–Ω–∏—é –°–û ‚Äî –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
            "–ù–µ–ª—å–∑—è –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬ª: –≤ 861 –Ω–µ—Ç –∞–≤—Ç–æ–º–µ—Ö–∞–Ω–∏–∑–º–∞; –Ω—É–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É/–ø—Ä–æ—Ü–µ–¥—É—Ä–µ",
        ],
        "a": 3,
        "why_wrong": {
            0: "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–º ‚Äî –ª–æ–≤—É—à–∫–∞: –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç ¬´–ø–æ–∫–∞–∂–∏—Ç–µ –ø—É–Ω–∫—Ç¬ª.",
            1: "–¢–æ–∂–µ –∫—Ä–∞–π–Ω–æ—Å—Ç—å: –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã, –Ω–æ –Ω–µ ¬´–Ω–∏–∫–æ–≥–¥–∞¬ª.",
            2: "–ë–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ‚Äî —Ä–∏—Å–∫.",
        },
        "why_right": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞–∑—ä—è—Å–Ω—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: –≤ –¥–µ–ª–∞—Ö –æ –Ω–µ—É—Å—Ç–æ–π–∫–µ —Å—É–¥—ã –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º.",
        "risk": "–û—à–∏–±–∫–∞ = –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ —Å—Ä–æ–∫–∞–º",
    },
    {
        "id": 9,
        "q": "–ö–µ–π—Å: –∫–ª–∏–µ–Ω—Ç —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –ü–£–≠, –°–û –Ω–∞ 861. –û–ø–µ—Ä–∞—Ç–æ—Ä—É –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å ¬´–∫—Ç–æ –ø—Ä–∞–≤¬ª. –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å?",
        "options": [
            "–í—Å–µ–≥–¥–∞ –ø—Ä–∞–≤ 861",
            "–í—Å–µ–≥–¥–∞ –ø—Ä–∞–≤ –ü–£–≠",
            "–í—Å–µ–≥–¥–∞ –ø—Ä–∞–≤ –∫–ª–∏–µ–Ω—Ç",
            "–ù–µ –¥–∞–≤–∞—Ç—å ¬´–∏–µ—Ä–∞—Ä—Ö–∏—é –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É¬ª: –Ω—É–∂–µ–Ω —Ä–∞–∑–±–æ—Ä –Ω–æ—Ä–º –∏ —Ñ–∞–∫—Ç–æ–≤; –æ–ø–µ—Ä–∞—Ç–æ—Ä —ç—Å–∫–∞–ª–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ",
        ],
        "a": 3,
        "why_wrong": {
            0: "–ö–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç—å –æ–ø–∞—Å–Ω–∞: –Ω–æ—Ä–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å–ª–æ–∂–Ω–µ–µ.",
            1: "–¢–æ –∂–µ —Å–∞–º–æ–µ: –Ω–µ–ª—å–∑—è –æ–±—ä—è–≤–ª—è—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞.",
            2: "–û–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –∑–∞–Ω–∏–º–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω—É, –æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É.",
        },
        "why_right": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ: —Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–±–æ—Ä, –±–µ–∑ –æ–±–µ—â–∞–Ω–∏–π.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: –ø–æ —Ç–∞–∫–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º —Å—É–¥—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∫–æ–º–ø–ª–µ–∫—Å –Ω–æ—Ä–º –∏ —Ñ–∞–∫—Ç—ã.",
        "risk": "–û—à–∏–±–∫–∞ = –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    },
    {
        "id": 10,
        "q": "–ö–µ–π—Å: –∫–ª–∏–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç ¬´–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π –æ—Ç–≤–µ—Ç¬ª –∏ –¥–∞–≤–∏—Ç. –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø –æ–±—â–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ 861:",
        "options": [
            "–í—Å–µ–≥–¥–∞ –¥–∞–≤–∞—Ç—å –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π –æ—Ç–≤–µ—Ç",
            "–í—Å–µ–≥–¥–∞ –∑–∞—â–∏—â–∞—Ç—å –°–û",
            "–í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –§–ê–°",
            "–ù–µ –æ–±–µ—â–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ —Ç–∞–º, –≥–¥–µ 861 –Ω–µ –¥–∞—ë—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞; –¥–∞–≤–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ —à–∞–≥–∏ –∏ –æ—Ñ–æ—Ä–º–ª—è—Ç—å —ç—Å–∫–∞–ª–∞—Ü–∏—é",
        ],
        "a": 3,
        "why_wrong": {
            0: "¬´–û–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å¬ª –±–µ–∑ –Ω–æ—Ä–º—ã = –±—É–¥—É—â–∞—è –∂–∞–ª–æ–±–∞.",
            1: "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π.",
            2: "–§–ê–° ‚Äî –Ω–µ ¬´–ø–µ—Ä–≤—ã–π —à–∞–≥¬ª; —Å–Ω–∞—á–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.",
        },
        "why_right": "–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∂–∞–ª–æ–±—ã –∏ –∑–∞—â–∏—â–∞–µ—Ç –∏ –∫–ª–∏–µ–Ω—Ç–∞, –∏ –°–û.",
        "practice": "–ü—Ä–∞–∫—Ç–∏–∫–∞: –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —á–∞—Å—Ç–æ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –Ω–µ–≤–µ—Ä–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –Ω–∞ –ø–µ—Ä–≤–æ–π –ª–∏–Ω–∏–∏.",
        "risk": "–û—à–∏–±–∫–∞ = —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∂–∞–ª–æ–±—ã",
    },
]

def ensure_storage():
    os.makedirs(DATA_DIR, exist_ok=True)
    if not os.path.exists(RESULTS_CSV):
        with open(RESULTS_CSV, "w", newline="", encoding="utf-8") as f:
            csv.writer(f).writerow([
                "timestamp_iso","operator_name","group","attempt_no","mode","score",
                "pass_by_score","critical_missed","passed","duration_sec","answers_json"
            ])

def load_results() -> pd.DataFrame:
    ensure_storage()
    try:
        return pd.read_csv(RESULTS_CSV)
    except Exception:
        return pd.DataFrame()

def next_attempt_no(df: pd.DataFrame, operator_name: str) -> int:
    if df.empty:
        return 1
    sub = df[df["operator_name"].astype(str).str.lower() == operator_name.lower()]
    if sub.empty:
        return 1
    try:
        return int(pd.to_numeric(sub["attempt_no"], errors="coerce").max()) + 1
    except Exception:
        return 1

def save_result(row: Dict[str, Any]):
    ensure_storage()
    with open(RESULTS_CSV, "a", newline="", encoding="utf-8") as f:
        csv.writer(f).writerow([
            row["timestamp_iso"], row["operator_name"], row["group"], row["attempt_no"],
            row["mode"], row["score"], row["pass_by_score"], row["critical_missed"],
            row["passed"], row["duration_sec"], row["answers_json"]
        ])

def register_cyrillic_font():
    for p in [
        "/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf",
        "/usr/share/fonts/truetype/dejavu/DejaVuSansCondensed.ttf",
    ]:
        if os.path.exists(p):
            try:
                pdfmetrics.registerFont(TTFont("DejaVu", p))
                return "DejaVu"
            except Exception:
                pass
    return "Helvetica"

def make_protocol_pdf(result: Dict[str, Any], answers: Dict[int, Dict[str, Any]]) -> bytes:
    font_name = register_cyrillic_font()
    buf = io.BytesIO()
    doc = SimpleDocTemplate(buf, pagesize=A4, leftMargin=15*mm, rightMargin=15*mm, topMargin=15*mm, bottomMargin=15*mm)
    styles = getSampleStyleSheet()

    base = ParagraphStyle("Base", parent=styles["Normal"], fontName=font_name, fontSize=10, leading=13)
    title = ParagraphStyle("TitleX", parent=styles["Title"], fontName=font_name, fontSize=14, leading=18, spaceAfter=10)
    h = ParagraphStyle("H", parent=styles["Heading2"], fontName=font_name, fontSize=12, leading=15, spaceBefore=8, spaceAfter=6)
    small = ParagraphStyle("Small", parent=styles["Normal"], fontName=font_name, fontSize=9, leading=12)

    story = []
    story.append(Paragraph("–ü–†–û–¢–û–ö–û–õ –ê–¢–¢–ï–°–¢–ê–¶–ò–ò (–ü–ü –†–§ ‚Ññ 861 ‚Äî –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)", title))
    story.append(Paragraph(f"–î–∞—Ç–∞/–≤—Ä–µ–º—è: <b>{result['timestamp_iso']}</b>", base))
    story.append(Paragraph(f"–û–ø–µ—Ä–∞—Ç–æ—Ä: <b>{result['operator_name']}</b> &nbsp;&nbsp; –ì—Ä—É–ø–ø–∞: <b>{result['group']}</b>", base))
    story.append(Paragraph(f"–†–µ–∂–∏–º: <b>{result['mode']}</b> &nbsp;&nbsp; –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ: <b>{result['attempt_no']}</b>", base))
    story.append(Paragraph(f"–ë–∞–ª–ª—ã: <b>{result['score']} / {len(QUESTIONS)}</b> &nbsp;&nbsp; –í—Ä–µ–º—è: <b>{result['duration_sec']} —Å–µ–∫</b>", base))
    story.append(Paragraph(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏: <b>{result['critical_missed']}</b> &nbsp;&nbsp; –ò—Ç–æ–≥: <b>{'–ü–†–û–ô–î–ï–ù–ê' if result['passed'] else '–ù–ï –ü–†–û–ô–î–ï–ù–ê'}</b>", base))
    story.append(Spacer(1, 10))
    story.append(Paragraph("–†–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤", h))

    data = [[
        Paragraph("<b>‚Ññ</b>", small),
        Paragraph("<b>–°–∏—Ç—É–∞—Ü–∏—è</b>", small),
        Paragraph("<b>–í–∞—à –æ—Ç–≤–µ—Ç</b>", small),
        Paragraph("<b>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π</b>", small),
        Paragraph("<b>–°—Ç–∞—Ç—É—Å</b>", small),
    ]]
    for q in QUESTIONS:
        qid = q["id"]
        a = answers.get(qid, {})
        your = a.get("your", "‚Äî")
        correct = a.get("correct", "‚Äî")
        ok = bool(a.get("ok", False))
        status = ("‚úÖ –í–µ—Ä–Ω–æ" if ok else "‚ùå –ù–µ–≤–µ—Ä–Ω–æ") + (" (–ö–†–ò–¢.)" if (qid in CRITICAL_Q_IDS and not ok) else "")
        data.append([
            Paragraph(str(qid), small),
            Paragraph(q["q"], small),
            Paragraph(str(your), small),
            Paragraph(str(correct), small),
            Paragraph(status, small),
        ])

    table = Table(data, colWidths=[8*mm, 95*mm, 45*mm, 45*mm, 20*mm])
    table.setStyle(TableStyle([
        ("BACKGROUND", (0,0), (-1,0), colors.lightgrey),
        ("GRID", (0,0), (-1,-1), 0.25, colors.grey),
        ("VALIGN", (0,0), (-1,-1), "TOP"),
        ("FONTNAME", (0,0), (-1,-1), font_name),
        ("FONTSIZE", (0,0), (-1,-1), 9),
        ("LEFTPADDING", (0,0), (-1,-1), 4),
        ("RIGHTPADDING", (0,0), (-1,-1), 4),
        ("TOPPADDING", (0,0), (-1,-1), 4),
        ("BOTTOMPADDING", (0,0), (-1,-1), 4),
    ]))
    story.append(table)
    story.append(Spacer(1, 10))
    story.append(Paragraph("–ü–æ–¥–ø–∏—Å—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–∏—Ü–∞: _______________________", base))
    story.append(Paragraph("–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—Ü–µ–Ω–∫–∏ –¥–æ–ø—É—Å–∫–∞ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è–º.", base))

    doc.build(story)
    return buf.getvalue()

st.markdown("""
<style>
html, body, [class*="css"]  { font-size: 18px !important; }
h1 { font-size: 34px !important; }
h2 { font-size: 26px !important; }
h3 { font-size: 22px !important; }
div[data-testid="stRadio"] label { font-size: 18px !important; }
</style>
""", unsafe_allow_html=True)

st.title("‚úÖ –ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ö–¶ –ø–æ 861 –ü–ü –†–§")
st.caption("PDF-–ø—Ä–æ—Ç–æ–∫–æ–ª ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è ‚Ä¢ –î–∞—à–±–æ—Ä–¥ (–ø–∞—Ä–æ–ª—å)")

page = st.sidebar.radio("–†–∞–∑–¥–µ–ª", ["–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è", "–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è", "–î–∞—à–±–æ—Ä–¥"], index=0)
df_results = load_results()

def operator_form(key_prefix: str):
    c1, c2 = st.columns([2, 1])
    with c1:
        name = st.text_input("–§–ò–û –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞", key=f"{key_prefix}_name", placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á").strip()
    with c2:
        group = st.selectbox("–ì—Ä—É–ø–ø–∞", ["–¶–û–í", "–ì–õ"], key=f"{key_prefix}_group")
    return name, group

def start_exam(mode: str, name: str, group: str):
    st.session_state.exam = {
        "mode": mode, "name": name, "group": group,
        "start": time.time(), "i": 0, "score": 0,
        "answers": {}, "attempt_no": next_attempt_no(df_results, name), "done": False
    }

def render_exam():
    exam = st.session_state.exam
    i = exam["i"]
    total = len(QUESTIONS)
    elapsed = int(time.time() - exam["start"])

    st.progress(i / total if total else 0)
    st.markdown(f"**–í—Ä–µ–º—è:** {elapsed} —Å–µ–∫ ‚Ä¢ **–ë–∞–ª–ª—ã:** {exam['score']} ‚Ä¢ **–ü–æ–ø—ã—Ç–∫–∞ ‚Ññ:** {exam['attempt_no']} ‚Ä¢ **–†–µ–∂–∏–º:** {exam['mode']}")

    if i >= total:
        exam["done"] = True
        return

    q = QUESTIONS[i]
    st.markdown(f"""
<div style="border: 2px solid #ddd; padding: 14px; border-radius: 10px; margin-top: 10px;">
  <div style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">–í–æ–ø—Ä–æ—Å {i+1} / {total}</div>
  <div style="font-size: 20px; font-weight: 600;">{q['q']}</div>
  <div style="margin-top: 10px; font-size: 16px; opacity: 0.9;"><b>–°—É–¥–µ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:</b> {q['practice']}</div>
</div>
""", unsafe_allow_html=True)

    choice = st.radio("–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç:", q["options"], index=None, key=f"q_{q['id']}_{exam['attempt_no']}")

    if st.button("–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç", use_container_width=True):
        if choice is None:
            st.warning("–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞.")
            return

        correct_text = q["options"][q["a"]]
        picked_idx = q["options"].index(choice)
        ok = (picked_idx == q["a"])

        exam["answers"][q["id"]] = {"your": choice, "correct": correct_text, "ok": ok}
        if ok:
            exam["score"] += 1
            st.success("‚úÖ –í–µ—Ä–Ω–æ.")
            st.info(f"–ü–æ—á–µ–º—É —ç—Ç–æ –≤–µ—Ä–Ω–æ: {q['why_right']}")
        else:
            st.error("‚ùå –ù–µ–≤–µ—Ä–Ω–æ.")
            wrong_reason = q.get("why_wrong", {}).get(picked_idx, "–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º/–ø—Ä–∞–∫—Ç–∏–∫–µ –≤ –¥–∞–Ω–Ω–æ–º –∫–µ–π—Å–µ.")
            st.write(f"**–ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–µ–Ω:** {wrong_reason}")
            st.write(f"**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:** {correct_text}")
            st.info(f"**–ü–æ—á–µ–º—É –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:** {q['why_right']}")
            st.warning(f"–†–∏—Å–∫ –æ—à–∏–±–∫–∏: {q['risk']}")

        exam["i"] += 1
        st.rerun()

def finalize_exam():
    exam = st.session_state.exam
    duration = int(time.time() - exam["start"])

    critical_missed = 0
    for qid in CRITICAL_Q_IDS:
        a = exam["answers"].get(qid)
        if a is None or (not a.get("ok", False)):
            critical_missed += 1

    pass_by_score = exam["score"] >= PASS_SCORE
    passed = pass_by_score and (critical_missed == 0)

    result = {
        "timestamp_iso": datetime.now().isoformat(timespec="seconds"),
        "operator_name": exam["name"],
        "group": exam["group"],
        "attempt_no": exam["attempt_no"],
        "mode": exam["mode"],
        "score": exam["score"],
        "pass_by_score": pass_by_score,
        "critical_missed": critical_missed,
        "passed": passed,
        "duration_sec": duration,
        "answers_json": str(exam["answers"]).replace("\n", " "),
    }

    save_result(result)

    st.header("–ò—Ç–æ–≥ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏")
    st.write(f"–û–ø–µ—Ä–∞—Ç–æ—Ä: **{result['operator_name']}** ‚Äî –≥—Ä—É–ø–ø–∞: **{result['group']}**")
    st.write(f"–ë–∞–ª–ª—ã: **{result['score']} / {len(QUESTIONS)}** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏: **{critical_missed}** | –í—Ä–µ–º—è: **{duration} —Å–µ–∫**")

    st.success("–°–ø–∞—Å–∏–±–æ! –í–∏–¥–Ω–æ, —á—Ç–æ —Ç—ã —Ä–µ–∞–ª—å–Ω–æ –≤–Ω–∏–∫–∞–µ—à—å –≤ —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã. –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∏ —Å–Ω–∏–∂–∞–µ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏.")

    if passed:
        st.balloons()
        st.success("‚úÖ –ê–¢–¢–ï–°–¢–ê–¶–ò–Ø –ü–†–û–ô–î–ï–ù–ê. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.")
    else:
        st.warning("‚ùå –ê–¢–¢–ï–°–¢–ê–¶–ò–Ø –ù–ï –ü–†–û–ô–î–ï–ù–ê. –ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ ‚Äî —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π —Ç–µ—Å—Ç. –†–∞–∑–±–µ—Ä—ë–º –æ—à–∏–±–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏–º.")

    pdf_bytes = make_protocol_pdf(result, exam["answers"])
    filename = f"protocol_861_{result['operator_name'].replace(' ', '_')}_attempt{result['attempt_no']}.pdf"
    st.download_button("‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª (PDF)", data=pdf_bytes, file_name=filename, mime="application/pdf", use_container_width=True)

    c1, c2 = st.columns(2)
    with c1:
        if st.button("–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ (–Ω–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞)", use_container_width=True):
            st.session_state.pop("exam", None)
            st.rerun()
    with c2:
        if st.button("–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—é", use_container_width=True):
            st.session_state.retake = {"name": exam["name"], "group": exam["group"]}
            st.success("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∞. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è¬ª.")

if page == "–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è":
    st.subheader("–°—Ç–∞—Ä—Ç –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏")
    name, group = operator_form("main")
    if st.button("–ù–∞—á–∞—Ç—å", use_container_width=True):
        if not name:
            st.error("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.")
        else:
            start_exam("–û–°–ù–û–í–ù–ê–Ø", name, group)
            st.rerun()

    if "exam" in st.session_state and st.session_state.exam.get("mode") == "–û–°–ù–û–í–ù–ê–Ø":
        st.divider()
        render_exam()
        if st.session_state.exam.get("done"):
            st.divider()
            finalize_exam()

elif page == "–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è":
    st.subheader("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è")
    preset = st.session_state.get("retake", {})
    c1, c2 = st.columns([2, 1])
    with c1:
        name = st.text_input("–§–ò–û –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞", value=preset.get("name", ""), key="rt_name").strip()
    with c2:
        group = st.selectbox("–ì—Ä—É–ø–ø–∞", ["–¶–û–í", "–ì–õ"], index=(0 if preset.get("group", "–¶–û–í") == "–¶–û–í" else 1), key="rt_group")

    st.info("–†–µ–∂–∏–º ¬´–ü–û–í–¢–û–†–ù–ê–Ø¬ª —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ.")
    if st.button("–ù–∞—á–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é", use_container_width=True):
        if not name:
            st.error("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.")
        else:
            start_exam("–ü–û–í–¢–û–†–ù–ê–Ø", name, group)
            st.rerun()

    if "exam" in st.session_state and st.session_state.exam.get("mode") == "–ü–û–í–¢–û–†–ù–ê–Ø":
        st.divider()
        render_exam()
        if st.session_state.exam.get("done"):
            st.divider()
            finalize_exam()

else:
    st.subheader("–î–∞—à–±–æ—Ä–¥ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è / –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞")
    pwd = st.sidebar.text_input("–ü–∞—Ä–æ–ª—å –¥–∞—à–±–æ—Ä–¥–∞", type="password")
    if pwd != DASHBOARD_PASSWORD:
        st.error("–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.")
        st.stop()

    df = df_results.copy()
    if df.empty:
        st.warning("–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–æ–π–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—é.")
        st.stop()

    df["timestamp_iso"] = pd.to_datetime(df["timestamp_iso"], errors="coerce")
    df["score"] = pd.to_numeric(df["score"], errors="coerce")
    df["passed"] = df["passed"].astype(str).str.lower().isin(["true","1","yes"])

    f1, f2, f3 = st.columns(3)
    with f1:
        grp_f = st.selectbox("–ì—Ä—É–ø–ø–∞", ["(–≤—Å–µ)","–¶–û–í","–ì–õ"], index=0)
    with f2:
        mode_f = st.selectbox("–†–µ–∂–∏–º", ["(–≤—Å–µ)"] + sorted(df["mode"].dropna().unique().tolist()), index=0)
    with f3:
        only_failed = st.checkbox("–¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–∞–ª—ã", value=False)

    dff = df.copy()
    if grp_f != "(–≤—Å–µ)":
        dff = dff[dff["group"].astype(str) == grp_f]
    if mode_f != "(–≤—Å–µ)":
        dff = dff[dff["mode"].astype(str) == mode_f]
    if only_failed:
        dff = dff[~dff["passed"]]

    total = len(dff)
    pass_rate = (dff["passed"].mean()*100) if total else 0
    avg_score = float(dff["score"].mean()) if total else 0
    avg_time = float(pd.to_numeric(dff["duration_sec"], errors="coerce").mean()) if total else 0

    k1,k2,k3,k4 = st.columns(4)
    k1.metric("–ü–æ–ø—ã—Ç–æ–∫", f"{total}")
    k2.metric("–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è", f"{pass_rate:.1f}%")
    k3.metric("–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª", f"{avg_score:.2f}")
    k4.metric("–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (—Å–µ–∫)", f"{avg_time:.0f}")

    st.divider()
    st.markdown("### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏")
    show_cols = ["timestamp_iso","operator_name","group","mode","attempt_no","score","critical_missed","passed","duration_sec"]
    st.dataframe(dff.sort_values("timestamp_iso", ascending=False)[show_cols].head(50), use_container_width=True, hide_index=True)

    st.divider()
    st.markdown("### –¢–æ–ø –ø—Ä–æ–≤–∞–ª–æ–≤")
    fails = dff[~dff["passed"]].copy()
    if not fails.empty:
        grp = fails.groupby(["operator_name","group"], as_index=False).agg(
            fails=("passed","count"),
            last_attempt=("timestamp_iso","max"),
            best_score=("score","max"),
        ).sort_values(["fails","last_attempt"], ascending=[False, False]).head(20)
        st.dataframe(grp, use_container_width=True, hide_index=True)
    else:
        st.success("–ü—Ä–æ–≤–∞–ª–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ –Ω–µ—Ç üëç")

    out = io.StringIO()
    dff.to_csv(out, index=False)
    st.download_button("‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –≤—ã–≥—Ä—É–∑–∫—É (CSV)", data=out.getvalue().encode("utf-8"), file_name="attestation_results_export.csv", mime="text/csv", use_container_width=True)
